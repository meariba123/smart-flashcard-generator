{% extends "layout.html" %}

{% block content %}
<h2 style="text-align:center; margin: 20px 0;">ðŸ“Š Your Progress</h2>

<div style="width:80%; margin:auto;">
  <canvas id="progressChart"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
fetch("{{ url_for('get_progress') if false else url_for('progress.get_progress') }}") // fallback - explicit blueprint endpoint
  .then(res => res.json())
  .then(data => {
    if (!data || data.sets.length === 0) {
      document.getElementById('progressChart').outerHTML =
        "<p style='text-align:center; margin-top:20px;'>No progress yet â€” try a quiz to see results here!</p>";
      return;
    }

    const ctx = document.getElementById('progressChart').getContext('2d');
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: data.sets,
        datasets: [{
          label: 'Accuracy (%)',
          data: data.accuracy,
          backgroundColor: 'rgba(54, 162, 235, 0.6)',
          borderColor: 'rgba(54, 162, 235, 1)',
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: false },
          tooltip: {
            callbacks: {
              label: function(context) {
                return context.parsed.y + "%";
              }
            }
          }
        },
        scales: {
          y: {
            beginAtZero: true,
            max: 100,
            title: { display: true, text: "Accuracy (%)" }
          },
          x: {
            title: { display: true, text: "Flashcard Sets" }
          }
        }
      }
    });
  })
  .catch(err => {
    console.error("Error loading progress:", err);
    document.getElementById('progressChart').outerHTML =
      "<p style='text-align:center; margin-top:20px;'>Error loading progress data.</p>";
  });
</script>
{% endblock %}
