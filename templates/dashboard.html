{% extends "layout.html" %}
{% block content %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='/css/dashboard.css') }}">
</head>
<body>
  <h2>Welcome, {{ session.username }}</h2>

  <!-- Upload Section -->
    <div class="upload-box">
    <form id="uploadForm" enctype="multipart/form-data" method="POST" action="{{ url_for('upload_file') }}">
      <label for="fileInput" class="upload-label">
        <div class="upload-icon">ðŸ“‚</div>
        <p>Upload or drag a file here</p>
        <p class="hint">PDF, DOCX, PPT, Image, TXT</p>
        <input type="file" id="fileInput" name="file" style="display:none" required>
        <button type="submit" class="btn">Choose File</button>
      </label>
    </form>
  </div>
{% endblock %}

  <!-- Flashcard preview + save form (hidden initially) -->
  <div id="flashcardPreviewContainer" class="flashcard-preview hidden">
    <h3>Generated Flashcards (Preview)</h3>
    <ul id="flashcardList"></ul>

    <!-- Save area only shows after preview -->
    <div class="save-set-box">
      <label for="setNameInput">Save to Flashcard Set:</label>
      <input type="text" id="setNameInput" name="set_name" placeholder="Enter new set name" required>
      <button type="submit" form="flashcardPreviewForm">Save Flashcards</button>
      <button type="button" id="cancelPreview">Cancel</button>
    </div>

    <!-- Hidden form for saving flashcards -->
    <form id="flashcardPreviewForm" method="POST" action="{{ url_for('save_generated_flashcards') }}">
    </form>
  </div>

  <script>
    // Button opens hidden file input
    document.getElementById("uploadBtn").addEventListener("click", () => {
      document.getElementById("notesFile").click();
    });

    // Show preview function (called after upload/AI returns flashcards)
    function showPreview(flashcards) {
      const previewList = document.getElementById("flashcardList");
      const previewForm = document.getElementById("flashcardPreviewForm");
      const previewContainer = document.getElementById("flashcardPreviewContainer");

      previewList.innerHTML = "";
      previewForm.innerHTML = "";

      flashcards.forEach(fc => {
        let li = document.createElement("li");
        li.innerHTML = `<strong>${fc.question}</strong><br>${fc.answer}`;

        // hidden inputs for saving
        let qInput = document.createElement("input");
        qInput.type = "hidden";
        qInput.name = "questions";
        qInput.value = fc.question;

        let aInput = document.createElement("input");
        aInput.type = "hidden";
        aInput.name = "answers";
        aInput.value = fc.answer;

        previewForm.appendChild(qInput);
        previewForm.appendChild(aInput);
        previewList.appendChild(li);
      });

      previewContainer.classList.remove("hidden");
      previewContainer.classList.add("show");
      document.getElementById("uploadBox").style.display = "none";
    }

    // Cancel preview â†’ back to upload
    document.getElementById("cancelPreview").addEventListener("click", () => {
      document.getElementById("flashcardPreviewContainer").classList.add("hidden");
      document.getElementById("flashcardPreviewContainer").classList.remove("show");
      document.getElementById("uploadBox").style.display = "block";
    });
  </script>
</body>
</html>
